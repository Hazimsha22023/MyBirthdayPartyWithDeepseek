<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Special 22nd Birthday!</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: #333;
            overflow: hidden;
            transition: background 0.5s;
        }
        
        .container {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 600px;
            position: relative;
            animation: fadeIn 1.5s ease-out;
            z-index: 10;
            margin: 20px;
        }
        
        h1 {
            color: #ff6b6b;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .countdown {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .countdown-box {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            min-width: 70px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .countdown-number {
            font-size: 2.5em;
            font-weight: bold;
        }
        
        .countdown-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            display: none;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        /* Cake Scene */
        .cake-scene {
            display: none;
        }
        
        .cake-container {
            position: relative;
            margin: 30px auto;
            width: 200px;
            height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Center vertically */
        }
        
        .cake {
            width: 180px;
            height: 80px;
            background: linear-gradient(135deg, #f9d5bb 0%, #e8b38c 100%);
            border-radius: 10px 10px 0 0;
            position: relative;
            margin-top: 40px; /* Push cake down from center */
        }
        
        .cake:after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 180px;
            height: 20px;
            background: linear-gradient(135deg, #d4a373 0%, #b5835a 100%);
            border-radius: 0 0 10px 10px;
        }
        
        .candle {
            width: 12px;
            height: 50px;
            background: linear-gradient(to right, #f5f5f5, #e0e0e0);
            border-radius: 6px;
            position: absolute;
            top: 40px; /* Adjusted to match cake's margin-top */
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
        }
        
        .flame {
            width: 15px;
            height: 30px;
            background: linear-gradient(to bottom, #ffff00, #ff9900, #ff3300);
            border-radius: 50% 50% 20% 20%;
            position: absolute;
            top: -30px; /* Position relative to candle */
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 15px #ff6600, 0 0 30px #ff9900;
            animation: flicker 1.5s infinite alternate;
            z-index: 3;
        }
        
        /* Birthday Message */
        .birthday-message {
            display: none;
            animation: fadeIn 1.5s ease-out;
        }
        
        .letter {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            max-width: 500px;
            margin: 0 auto;
            text-align: left;
        }
        
        .letter:before {
            content: "";
            position: absolute;
            top: 0;
            left: 20px;
            right: 20px;
            height: 10px;
            background: rgba(255, 107, 107, 0.4);
            border-radius: 10px 10px 0 0;
        }
        
        /* Music Controls */
        .music-controls {
            margin-top: 20px;
            text-align: center;
        }
        
        #musicToggle {
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid #ff6b6b;
            border-radius: 50px;
            padding: 8px 15px;
            font-size: 1em;
            cursor: pointer;
            color: #ff6b6b;
            transition: all 0.3s;
        }
        
        #musicToggle:hover {
            background: #ff6b6b;
            color: white;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes flicker {
            0%, 100% { transform: translateX(-50%) scale(1); opacity: 1; }
            25% { transform: translateX(-50%) scale(1.1, 0.9); }
            50% { transform: translateX(-50%) scale(0.9, 1.1) translateY(-5px); }
            75% { transform: translateX(-50%) scale(1.05, 0.95); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Balloons and Confetti */
        .balloon {
            position: absolute;
            width: 40px;
            height: 50px;
            background-color: #ff6b6b;
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
            z-index: 1;
        }
        
        .balloon:before {
            content: "";
            position: absolute;
            width: 1px;
            height: 100px;
            background-color: #ccc;
            bottom: -100px;
            left: 50%;
        }
        
        .balloon:nth-child(2) {
            background-color: #48dbfb;
            left: 15%;
            top: 20%;
            animation-delay: 0.5s;
        }
        
        .balloon:nth-child(3) {
            background-color: #1dd1a1;
            right: 15%;
            top: 30%;
            animation-delay: 1s;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            z-index: 0;
        }
        
        /* Mic Animation */
        .mic-icon {
            font-size: 2em;
            margin: 20px 0;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .countdown {
                gap: 10px;
            }
            
            .countdown-box {
                min-width: 60px;
                padding: 10px 15px;
            }
            
            .countdown-number {
                font-size: 2em;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Elements (hidden) -->
    <audio id="blowSound" src="./Candle Blow Out .mp3" preload="auto"></audio>
    <audio id="birthdayMusic" src="./Happy Birthday.mp3" preload="auto" loop></audio>

    <!-- Countdown Scene -->
    <div class="container countdown-scene">
        <h1 class="countdown-title">Countdown to Your 22nd Birthday!</h1>
        <h1 class="birthday-title" style="display: none;">Happy 22nd Birthday! ðŸŽ‰</h1>
        
        <div class="countdown">
            <div class="countdown-box">
                <div class="countdown-number" id="days">00</div>
                <div class="countdown-label">Days</div>
            </div>
            <div class="countdown-box">
                <div class="countdown-number" id="hours">00</div>
                <div class="countdown-label">Hours</div>
            </div>
            <div class="countdown-box">
                <div class="countdown-number" id="minutes">00</div>
                <div class="countdown-label">Minutes</div>
            </div>
            <div class="countdown-box">
                <div class="countdown-number" id="seconds">00</div>
                <div class="countdown-label">Seconds</div>
            </div>
        </div>
        
        <button class="btn" id="celebrateBtn">Celebrate Now!</button>
        <div class="music-controls">
            <button id="musicToggle">ðŸ”Š Toggle Music</button>
        </div>
    </div>
    
    <!-- Cake Scene -->
    <div class="container cake-scene">
        <h1>Make a Wish! ðŸŽ‚</h1>
        <div class="cake-container">
            <div class="candle">
                <div class="flame" id="flame"></div>
            </div>
            <div class="cake"></div>
        </div>
        <div class="instructions">
            <div class="mic-icon">ðŸŽ¤</div>
            <p>Blow on your microphone to blow out the candle!</p>
        </div>
        <div class="music-controls">
            <button id="musicToggle">ðŸ”Š Toggle Music</button>
        </div>
    </div>
    
    <!-- Birthday Message -->
    <div class="container birthday-message">
        <div class="letter">
            <h2>Happy 22nd Birthday! ðŸŽ‰</h2>
            <p>Dear Ha_Chan,</p>
            <p>Today marks your 22nd trip around the sun, and what an incredible journey it's been! As you blow out your candles, know that each one represents the light you bring into this world.</p>
            <p>At 22, you stand at the threshold of infinite possibilities. May this year bring you:</p>
            <ul>
                <li>Moments that take your breath away (in the best way possible)</li>
                <li>Adventures that become lifelong stories</li>
                <li>Growth that surprises even yourself</li>
                <li>Laughter that makes your stomach hurt</li>
                <li>Love that makes every day brighter</li>
            </ul>
            <p>Remember that age isn't just a number - it's a badge of all you've experienced and overcome. You're not getting older, you're getting more <em>you</em> with each passing year.</p>
            <p>Wishing you a day filled with all your favorite things and a year ahead that exceeds your wildest dreams!</p>
            <p class="signature">With warmest wishes,<br>Your Well-Wisher</p>
        </div>
        <div class="music-controls">
            <button id="musicToggle">ðŸ”Š Toggle Music</button>
        </div>
    </div>

    <script>
        // Set your birthday date (month is 0-indexed, so 0=January, 11=December)
        // Change this to your birthday date and time
        const birthday = new Date();
        birthday.setMonth(4); // June (0=Jan, 5=Jun)
        birthday.setDate(29); // 23rd
        birthday.setHours(0, 0, 0, 0); // Midnight
        
        // DOM Elements
        const countdownScene = document.querySelector('.countdown-scene');
        const cakeScene = document.querySelector('.cake-scene');
        const birthdayMessage = document.querySelector('.birthday-message');
        const celebrateBtn = document.getElementById('celebrateBtn');
        const flame = document.getElementById('flame');
        const countdownTitle = document.querySelector('.countdown-title');
        const birthdayTitle = document.querySelector('.birthday-title');
        
        // Audio Context for microphone
        let audioContext;
        let analyser;
        let microphone;
        let isBlowing = false;
        
        // Start birthday music when page loads
        window.addEventListener('DOMContentLoaded', (event) => {
            const birthdayMusic = document.getElementById('birthdayMusic');
            birthdayMusic.volume = 0.5; // Set volume to 50%
            
            // Try to play music (may be blocked by browser until user interacts)
            const playMusic = () => {
                birthdayMusic.play().catch(e => {
                    console.log("Autoplay prevented - will play after user interaction");
                });
            };
            
            // Try to play immediately
            playMusic();
            
            // Set up music toggle button
            const musicToggle = document.getElementById('musicToggle');
            musicToggle.addEventListener('click', function() {
                if (birthdayMusic.paused) {
                    birthdayMusic.play();
                    musicToggle.textContent = "ðŸ”Š Music On";
                } else {
                    birthdayMusic.pause();
                    musicToggle.textContent = "ðŸ”‡ Music Off";
                }
            });
            
            // Enable music on first user interaction (for browsers that block autoplay)
            document.body.addEventListener('click', function firstInteraction() {
                playMusic();
                document.body.removeEventListener('click', firstInteraction);
            });
        });

        function updateCountdown() {
            const now = new Date();
            const diff = birthday - now;
            
            // If birthday has arrived
            if (diff <= 0) {
                countdownTitle.style.display = 'none';
                birthdayTitle.style.display = 'block';
                document.getElementById('days').textContent = '00';
                document.getElementById('hours').textContent = '00';
                document.getElementById('minutes').textContent = '00';
                document.getElementById('seconds').textContent = '00';
                celebrateBtn.style.display = 'inline-block';
                return;
            }
            
            // Calculate time units
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            // Update display
            document.getElementById('days').textContent = days.toString().padStart(2, '0');
            document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
        }
        
        // Create balloons
        function createBalloons() {
            const colors = ['#ff6b6b', '#48dbfb', '#1dd1a1', '#feca57', '#5f27cd'];
            
            for (let i = 0; i < 10; i++) {
                const balloon = document.createElement('div');
                balloon.className = 'balloon';
                balloon.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                balloon.style.left = Math.random() * 100 + 'vw';
                balloon.style.top = Math.random() * 100 + 'vh';
                balloon.style.width = (Math.random() * 30 + 30) + 'px';
                balloon.style.height = (Math.random() * 40 + 40) + 'px';
                balloon.style.animationDuration = (Math.random() * 4 + 4) + 's';
                balloon.style.animationDelay = (Math.random() * 2) + 's';
                document.body.appendChild(balloon);
            }
        }
        
        // Create confetti
        function createConfetti() {
            const colors = ['#ff6b6b', '#48dbfb', '#1dd1a1', '#feca57', '#5f27cd'];
            const container = document.querySelector('body');
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = -10 + 'px';
                confetti.style.width = (Math.random() * 10 + 5) + 'px';
                confetti.style.height = (Math.random() * 10 + 5) + 'px';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                confetti.style.transform = 'rotate(' + Math.random() * 360 + 'deg)';
                container.appendChild(confetti);
                
                // Animate confetti
                setTimeout(() => {
                    confetti.style.opacity = '1';
                    confetti.style.transition = 'all ' + (Math.random() * 3 + 2) + 's ease-out';
                    confetti.style.top = '100vh';
                    confetti.style.left = (parseFloat(confetti.style.left) + (Math.random() * 200 - 100)) + 'px';
                }, Math.random() * 1000);
                
                // Remove confetti after animation
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }
        
        // Setup microphone for blowing detection
        async function setupMicrophone() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                microphone = audioContext.createMediaStreamSource(stream);
                microphone.connect(analyser);
                
                detectBlowing();
            } catch (error) {
                console.error("Error accessing microphone:", error);
                // Fallback to button click if microphone access is denied
                document.querySelector('.instructions').innerHTML = 
                    '<p>Microphone access denied. Click the button below to blow out the candle.</p>' +
                    '<button class="btn" id="manualBlowBtn">Blow Out Candle</button>';
                
                document.getElementById('manualBlowBtn').addEventListener('click', () => {
                    blowOutCandle();
                });
            }
        }
        
        // Detect blowing sound
        function detectBlowing() {
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            
            function checkVolume() {
                analyser.getByteFrequencyData(dataArray);
                let sum = 0;
                
                for (let i = 0; i < bufferLength; i++) {
                    sum += dataArray[i];
                }
                
                const average = sum / bufferLength;
                
                // If volume is high and we're not already blowing
                if (average > 60 && !isBlowing) {
                    isBlowing = true;
                    blowOutCandle();
                }
                
                requestAnimationFrame(checkVolume);
            }
            
            checkVolume();
        }
        
        // Blow out candle animation
        function blowOutCandle() {
            // Animate flame going out
            flame.style.animation = 'none';
            flame.style.transform = 'translateX(-50%) scale(0)';
            flame.style.opacity = '0';
            flame.style.transition = 'all 0.5s ease-out';
            
            // Play blowing sound
            const blowSound = document.getElementById('blowSound');
            blowSound.play();
            
            // Show birthday message after delay
            setTimeout(() => {
                cakeScene.style.display = 'none';
                birthdayMessage.style.display = 'block';
                createBalloons();
                setInterval(createConfetti, 3000);
                createConfetti();
            }, 1500);
        }
        
        // Event Listeners
        celebrateBtn.addEventListener('click', () => {
            countdownScene.style.display = 'none';
            cakeScene.style.display = 'block';
            setupMicrophone();
        });
        
        // Initialize
        updateCountdown();
        setInterval(updateCountdown, 1000);
        createBalloons();
    </script>
</body>
</html>